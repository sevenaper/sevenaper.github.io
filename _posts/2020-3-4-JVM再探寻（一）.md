---
title: JVM再探寻（一）：类加载机制
key: 20200304
tags: Java JVM
---
##　类加载机制
在Java代码中，类型的加载、连接与初始化过程都在程序运行期间完成的
> 类型加载最常见的方法是将磁盘中的字节码加载到内存中
> 连接：验证，确保被加载类的正确性；准备，为类的**静态变量**分配内存，并初始化为**默认值**；解析，将类中的符号引用转化为直接引用。
> 初始化对于静态变量进行赋值

Java程序对类的使用方式分为两种：
*   主动使用
    *   创建类的实例
    *   访问某个类或接口的静态变量，或对静态变量赋值
    *   调用类的静态方法
    *   反射
    *   初始化一个类的子类
    *   Java虚拟机启动时被标明为启动类的类
    *   JKD1.7开始提供的动态语言支持：java.lang.invoke.MethodHandle实例的解析结果REF_getStatic,REF_putStatic,REF_invokeStatic句柄对应的类没有初始化，则初始化
*   被动使用 除了上述7种情况，其他使用Java类的方式都被看作是对类的被动使用。并不会导致初始化

所有的Java虚拟机实现必须在每个类或接口被Java程序**首次主动使用**才初始化他们

对于静态字段来说，只有直接定义了该字段的类才会被初始化，当一个类在初始化时，其父类要求全部已经初始化完毕

常量在编译阶段会存入道调用这个常量的方法所在的类的常量池中，本质上，调用类并没有直接引用到定义常量的类，因此并不会出发定义常量的类的初始化

